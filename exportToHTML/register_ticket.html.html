<html>
<head>
<title>register_ticket.html</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #d5b778;}
.s1 { color: #bcbec4;}
.s2 { color: #bababa;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
register_ticket.html</font>
</center></td></tr></table>
<pre><span class="s0">&lt;!DOCTYPE </span><span class="s2">html</span><span class="s0">&gt;</span>
<span class="s0">&lt;html </span><span class="s2">lang</span><span class="s3">=&quot;en&quot;</span><span class="s0">&gt;</span>
<span class="s0">&lt;head&gt;</span>
    <span class="s0">&lt;meta </span><span class="s2">charset</span><span class="s3">=&quot;UTF-8&quot;</span><span class="s0">&gt;</span>
    <span class="s0">&lt;meta </span><span class="s2">name</span><span class="s3">=&quot;viewport&quot; </span><span class="s2">content</span><span class="s3">=&quot;width=device-width, initial-scale=1.0&quot;</span><span class="s0">&gt;</span>
    <span class="s0">&lt;title&gt;</span><span class="s1">Ticket Management Dashboard</span><span class="s0">&lt;/title&gt;</span>
    <span class="s0">&lt;link </span><span class="s2">rel</span><span class="s3">=&quot;stylesheet&quot; </span><span class="s2">href</span><span class="s3">=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot;</span><span class="s0">&gt;</span>
    <span class="s0">&lt;script </span><span class="s2">src</span><span class="s3">=&quot;https://code.jquery.com/jquery-3.6.0.min.js&quot;</span><span class="s0">&gt;&lt;/script&gt;</span>
    <span class="s0">&lt;script </span><span class="s2">src</span><span class="s3">=&quot;https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js&quot;</span><span class="s0">&gt;&lt;/script&gt;</span>
    <span class="s0">&lt;link </span><span class="s2">rel</span><span class="s3">=&quot;stylesheet&quot; </span><span class="s2">href</span><span class="s3">=&quot;https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css&quot;</span><span class="s0">&gt;</span>
<span class="s0">&lt;/head&gt;</span>
<span class="s0">&lt;body&gt;</span>
    <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;container mt-4&quot;</span><span class="s0">&gt;</span>
        <span class="s0">&lt;h2 </span><span class="s2">class</span><span class="s3">=&quot;mb-3&quot;</span><span class="s0">&gt;</span><span class="s1">Ticket Management Dashboard</span><span class="s0">&lt;/h2&gt;</span>

        <span class="s4">&lt;!-- Control Panel --&gt;</span>
        <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;d-flex justify-content-between mb-3&quot;</span><span class="s0">&gt;</span>
            <span class="s0">&lt;div&gt;</span>
                <span class="s0">&lt;a </span><span class="s2">href</span><span class="s3">=&quot;/register_ticket&quot; </span><span class="s2">class</span><span class="s3">=&quot;btn btn-primary&quot;</span><span class="s0">&gt;</span><span class="s1">Register Ticket</span><span class="s0">&lt;/a&gt;</span>
                <span class="s0">&lt;a </span><span class="s2">href</span><span class="s3">=&quot;/search_asset&quot; </span><span class="s2">class</span><span class="s3">=&quot;btn btn-secondary&quot;</span><span class="s0">&gt;</span><span class="s1">Search Asset</span><span class="s0">&lt;/a&gt;</span>
            <span class="s0">&lt;/div&gt;</span>
            <span class="s0">&lt;button </span><span class="s2">class</span><span class="s3">=&quot;btn btn-success&quot; </span><span class="s2">onclick</span><span class="s3">=&quot;exportToExcel()&quot;</span><span class="s0">&gt;</span><span class="s1">Export to Excel</span><span class="s0">&lt;/button&gt;</span>
        <span class="s0">&lt;/div&gt;</span>

        <span class="s4">&lt;!-- Date Range Filter --&gt;</span>
        <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;row mb-3&quot;</span><span class="s0">&gt;</span>
            <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;col-md-3&quot;</span><span class="s0">&gt;</span>
                <span class="s0">&lt;label </span><span class="s2">for</span><span class="s3">=&quot;start_date&quot;</span><span class="s0">&gt;</span><span class="s1">Start Date:</span><span class="s0">&lt;/label&gt;</span>
                <span class="s0">&lt;input </span><span class="s2">type</span><span class="s3">=&quot;date&quot; </span><span class="s2">id</span><span class="s3">=&quot;start_date&quot; </span><span class="s2">class</span><span class="s3">=&quot;form-control&quot;</span><span class="s0">&gt;</span>
            <span class="s0">&lt;/div&gt;</span>
            <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;col-md-3&quot;</span><span class="s0">&gt;</span>
                <span class="s0">&lt;label </span><span class="s2">for</span><span class="s3">=&quot;end_date&quot;</span><span class="s0">&gt;</span><span class="s1">End Date:</span><span class="s0">&lt;/label&gt;</span>
                <span class="s0">&lt;input </span><span class="s2">type</span><span class="s3">=&quot;date&quot; </span><span class="s2">id</span><span class="s3">=&quot;end_date&quot; </span><span class="s2">class</span><span class="s3">=&quot;form-control&quot;</span><span class="s0">&gt;</span>
            <span class="s0">&lt;/div&gt;</span>
            <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;col-md-3 align-self-end&quot;</span><span class="s0">&gt;</span>
                <span class="s0">&lt;button </span><span class="s2">class</span><span class="s3">=&quot;btn btn-info&quot; </span><span class="s2">onclick</span><span class="s3">=&quot;filterByDate()&quot;</span><span class="s0">&gt;</span><span class="s1">Apply Filter</span><span class="s0">&lt;/button&gt;</span>
            <span class="s0">&lt;/div&gt;</span>
        <span class="s0">&lt;/div&gt;</span>

        <span class="s4">&lt;!-- Ticket Table --&gt;</span>
        <span class="s0">&lt;table </span><span class="s2">id</span><span class="s3">=&quot;ticketTable&quot; </span><span class="s2">class</span><span class="s3">=&quot;display table table-striped&quot;</span><span class="s0">&gt;</span>
            <span class="s0">&lt;thead&gt;</span>
                <span class="s0">&lt;tr&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Ref No</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Title</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Technician</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Status</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Created At</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Closed At</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Customer</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Call Type</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Expected Completion</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Serial No</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">TAT</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Complete</span><span class="s0">&lt;/th&gt;</span>
                    <span class="s0">&lt;th&gt;</span><span class="s1">Action</span><span class="s0">&lt;/th&gt;</span>
                <span class="s0">&lt;/tr&gt;</span>
            <span class="s0">&lt;/thead&gt;</span>
            <span class="s0">&lt;tbody&gt;&lt;/tbody&gt;</span>
        <span class="s0">&lt;/table&gt;</span>
    <span class="s0">&lt;/div&gt;</span>

    <span class="s4">&lt;!-- Edit Modal --&gt;</span>
    <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;modal fade&quot; </span><span class="s2">id</span><span class="s3">=&quot;editModal&quot; </span><span class="s2">tabindex</span><span class="s3">=&quot;-1&quot;</span><span class="s0">&gt;</span>
        <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;modal-dialog&quot;</span><span class="s0">&gt;</span>
            <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;modal-content&quot;</span><span class="s0">&gt;</span>
                <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;modal-header&quot;</span><span class="s0">&gt;</span>
                    <span class="s0">&lt;h5 </span><span class="s2">class</span><span class="s3">=&quot;modal-title&quot;</span><span class="s0">&gt;</span><span class="s1">Edit Ticket</span><span class="s0">&lt;/h5&gt;</span>
                    <span class="s0">&lt;button </span><span class="s2">type</span><span class="s3">=&quot;button&quot; </span><span class="s2">class</span><span class="s3">=&quot;btn-close&quot; </span><span class="s2">data-bs-dismiss</span><span class="s3">=&quot;modal&quot;</span><span class="s0">&gt;&lt;/button&gt;</span>
                <span class="s0">&lt;/div&gt;</span>
                <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;modal-body&quot;</span><span class="s0">&gt;</span>
                    <span class="s0">&lt;form </span><span class="s2">id</span><span class="s3">=&quot;editForm&quot;</span><span class="s0">&gt;</span>
                        <span class="s0">&lt;input </span><span class="s2">type</span><span class="s3">=&quot;hidden&quot; </span><span class="s2">id</span><span class="s3">=&quot;edit_ref_no&quot;</span><span class="s0">&gt;</span>
                        <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;mb-3&quot;</span><span class="s0">&gt;</span>
                            <span class="s0">&lt;label </span><span class="s2">for</span><span class="s3">=&quot;edit_title&quot;</span><span class="s0">&gt;</span><span class="s1">Title</span><span class="s0">&lt;/label&gt;</span>
                            <span class="s0">&lt;input </span><span class="s2">type</span><span class="s3">=&quot;text&quot; </span><span class="s2">id</span><span class="s3">=&quot;edit_title&quot; </span><span class="s2">class</span><span class="s3">=&quot;form-control&quot;</span><span class="s0">&gt;</span>
                        <span class="s0">&lt;/div&gt;</span>
                        <span class="s0">&lt;div </span><span class="s2">class</span><span class="s3">=&quot;mb-3&quot;</span><span class="s0">&gt;</span>
                            <span class="s0">&lt;label </span><span class="s2">for</span><span class="s3">=&quot;edit_status&quot;</span><span class="s0">&gt;</span><span class="s1">Status</span><span class="s0">&lt;/label&gt;</span>
                            <span class="s0">&lt;select </span><span class="s2">id</span><span class="s3">=&quot;edit_status&quot; </span><span class="s2">class</span><span class="s3">=&quot;form-control&quot;</span><span class="s0">&gt;</span>
                                <span class="s0">&lt;option </span><span class="s2">value</span><span class="s3">=&quot;Open&quot;</span><span class="s0">&gt;</span><span class="s1">Open</span><span class="s0">&lt;/option&gt;</span>
                                <span class="s0">&lt;option </span><span class="s2">value</span><span class="s3">=&quot;In Progress&quot;</span><span class="s0">&gt;</span><span class="s1">In Progress</span><span class="s0">&lt;/option&gt;</span>
                                <span class="s0">&lt;option </span><span class="s2">value</span><span class="s3">=&quot;Closed&quot;</span><span class="s0">&gt;</span><span class="s1">Closed</span><span class="s0">&lt;/option&gt;</span>
                            <span class="s0">&lt;/select&gt;</span>
                        <span class="s0">&lt;/div&gt;</span>
                        <span class="s0">&lt;button </span><span class="s2">type</span><span class="s3">=&quot;submit&quot; </span><span class="s2">class</span><span class="s3">=&quot;btn btn-primary&quot;</span><span class="s0">&gt;</span><span class="s1">Update</span><span class="s0">&lt;/button&gt;</span>
                    <span class="s0">&lt;/form&gt;</span>
                <span class="s0">&lt;/div&gt;</span>
            <span class="s0">&lt;/div&gt;</span>
        <span class="s0">&lt;/div&gt;</span>
    <span class="s0">&lt;/div&gt;</span>

    <span class="s0">&lt;script&gt;</span>
        <span class="s1">function loadTickets() {</span>
            <span class="s1">$.get(&quot;/fetch_tickets&quot;, function(data) {</span>
                <span class="s1">let table = $(&quot;#ticketTable&quot;).DataTable();</span>
                <span class="s1">table.clear();</span>
                <span class="s1">data.forEach(ticket =&gt; {</span>
                    <span class="s1">table.row.add([</span>
                        <span class="s1">ticket.reference_no,</span>
                        <span class="s1">ticket.title,</span>
                        <span class="s1">ticket.technician_id,</span>
                        <span class="s1">ticket.status,</span>
                        <span class="s1">ticket.created_at,</span>
                        <span class="s1">ticket.closed_at || 'N/A',</span>
                        <span class="s1">ticket.customer,</span>
                        <span class="s1">ticket.call_type,</span>
                        <span class="s1">ticket.expected_completion_time,</span>
                        <span class="s1">ticket.serial_number,</span>
                        <span class="s1">ticket.tat,</span>
                        <span class="s1">ticket.complete,</span>
                        <span class="s1">`&lt;button class=&quot;btn btn-warning btn-sm&quot; onclick=&quot;editTicket('${ticket.reference_no}')&quot;&gt;Edit&lt;/button&gt;`</span>
                    <span class="s1">]).draw();</span>
                <span class="s1">});</span>
            <span class="s1">});</span>
        <span class="s1">}</span>

        <span class="s1">function editTicket(ref_no) {</span>
            <span class="s1">$.get(`/fetch_ticket/${ref_no}`, function(ticket) {</span>
                <span class="s1">$(&quot;#edit_ref_no&quot;).val(ticket.reference_no);</span>
                <span class="s1">$(&quot;#edit_title&quot;).val(ticket.title);</span>
                <span class="s1">$(&quot;#edit_status&quot;).val(ticket.status);</span>
                <span class="s1">$(&quot;#editModal&quot;).modal('show');</span>
            <span class="s1">});</span>
        <span class="s1">}</span>

        <span class="s1">$(&quot;#editForm&quot;).submit(function(event) {</span>
            <span class="s1">event.preventDefault();</span>
            <span class="s1">let data = {</span>
                <span class="s1">reference_no: $(&quot;#edit_ref_no&quot;).val(),</span>
                <span class="s1">title: $(&quot;#edit_title&quot;).val(),</span>
                <span class="s1">status: $(&quot;#edit_status&quot;).val()</span>
            <span class="s1">};</span>
            <span class="s1">$.post(&quot;/update_ticket&quot;, data, function(response) {</span>
                <span class="s1">alert(response.message);</span>
                <span class="s1">$(&quot;#editModal&quot;).modal('hide');</span>
                <span class="s1">loadTickets();</span>
            <span class="s1">});</span>
        <span class="s1">});</span>

        <span class="s1">$(document).ready(function() {</span>
            <span class="s1">$(&quot;#ticketTable&quot;).DataTable();</span>
            <span class="s1">loadTickets();</span>
        <span class="s1">});</span>

        <span class="s1">function exportToExcel() {</span>
            <span class="s1">window.location.href = &quot;/export_tickets&quot;;</span>
        <span class="s1">}</span>
    <span class="s0">&lt;/script&gt;</span>
<span class="s1">function loadTickets() {</span>
    <span class="s1">$.get(&quot;/fetch_tickets&quot;, function(data) {</span>
        <span class="s1">let table = $(&quot;#ticketTable&quot;).DataTable();</span>
        <span class="s1">table.clear();</span>
        <span class="s1">data.forEach(ticket =&gt; {</span>
            <span class="s1">table.row.add([</span>
                <span class="s1">ticket.id,</span>
                <span class="s1">ticket.reference_no,</span>
                <span class="s1">ticket.title,</span>
                <span class="s1">ticket.customer,</span>
                <span class="s1">ticket.call_type,</span>
                <span class="s1">ticket.technician_id || &quot;Unassigned&quot;,</span>
                <span class="s1">ticket.estimated_time + &quot; mins&quot;,</span>
                <span class="s1">ticket.travel_time + &quot; mins&quot;,</span>
                <span class="s1">ticket.status,</span>
                <span class="s1">ticket.created_at,</span>
                <span class="s1">`</span><span class="s0">&lt;button </span><span class="s2">class</span><span class="s3">=&quot;btn btn-warning btn-sm&quot; </span><span class="s2">onclick</span><span class="s3">=&quot;editTicket(${ticket.id})&quot;</span><span class="s0">&gt;</span><span class="s1">Edit</span><span class="s0">&lt;/button&gt;</span><span class="s1">`</span>
            <span class="s1">]).draw();</span>
        <span class="s1">});</span>
    <span class="s1">}).fail(function() {</span>
        <span class="s1">console.error(&quot;Error fetching tickets from the server.&quot;);</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s1">$(document).ready(function() {</span>
    <span class="s1">$(&quot;#ticketTable&quot;).DataTable();</span>
    <span class="s1">loadTickets();</span>
<span class="s1">});</span>
<span class="s0">&lt;script&gt;</span>
<span class="s1">&lt;/body&gt;</span>
<span class="s1">&lt;/html&gt;</span></pre>
</body>
</html>